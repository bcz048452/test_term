# 証明書更新_鍵作成手順.md

-----------------------------------------------------------------------------------
## 作業要件
-----------------------------------------------------------------------------------
|#|項目|内容|
|:--|:--|:--|
|1|対象システム|zabbix|
|2|対象ホスト|monmx9-01-01v|
|3|作業予定日|2024/09/24|

-----------------------------------------------------------------------------------
## 1. 鍵作成
-----------------------------------------------------------------------------------
1. サーバログイン<br>
   monmx9-01-01vにログインし、rootにスイッチする

2. random.dat作成
   ```
   tail -10 /var/log/messages > /tmp/random.dat
   ```

3. 秘密鍵作成
   ```
   /usr/bin/openssl genrsa -rand /tmp/random.dat -des 2048 > /tmp/key_monmx9-01-01v.bc-extra.net.pem_nopass
   ```

4. 秘密鍵のパスフレーズ解除
   ```
   /usr/bin/openssl rsa -in /tmp/key_monmx9-01-01v.bc-extra.net.pem_nopass -out /tmp/key_monmx9-01-01v.bc-extra.net.pem
   ```

5. CSR鍵作成
   ```
   /usr/bin/openssl req -new -key /tmp/key_monmx9-01-01v.bc-extra.net.pem -out /tmp/csr_monmx9-01-01v.bc-extra.net.pem
   ```

6. 作成後確認
   ```
   cd /tmp/
   ll
   ```

7. 作業用にファイルコピー
   ```
   cp csr_monmx9-01-01v.bc-extra.net.pem /home/shz009330/csr_monmx9-01-01v.bc-extra.net.pem
   ```
   ```
   cp key_monmx9-01-01v.bc-extra.net.pem /home/shz009330/key_monmx9-01-01v.bc-extra.net.pem
   ```

8. 移動して所有者変更
   ```
   cd /home/shz009330
   ```
   ```
   chown shz009330 key_monmx9-01-01v.bc-extra.net.pem
   ```
   ```
   chown shz009330 csr_monmx9-01-01v.bc-extra.net.pem
   ```

-----------------------------------------------------------------------------------
## 99. 事後作業
-----------------------------------------------------------------------------------
1. ファイル移動<br>
   /tmpにあるファイルを指定のパスに格納する
   ```
   \\benas\dep\2a0400\05-全員\業務共有\サーバ運用\デジタルID\03.証明書\商品系_2024\Azure特殊
   ```
