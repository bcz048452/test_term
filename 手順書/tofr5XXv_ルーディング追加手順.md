# tofr5XXv_ルーティング追加手順

-----------------------------------------------------------------------------------
## 作業要件
-----------------------------------------------------------------------------------
|#|項目|内容|
|:--|:--|:--|
|1|対象システム|Hybrid講座システム 特別教材マルチOS|
|2|対象ホスト|tofr501v,tofr502v,tofr511v,tofr521v,tofr531v|
|3|作業予定日|2024/02/27|

-----------------------------------------------------------------------------------
## 1. 事前作業
-----------------------------------------------------------------------------------
1. 作業開始連絡  
    関係者に作業開始の連絡を行う

-----------------------------------------------------------------------------------
## 2. サーバログイン
-----------------------------------------------------------------------------------
1. Tera Termにログインする

2. root権限へ昇格する
    ```
    su -
    ```

3. ログイン先のサーバ名を確認する
   ```
   uname -n
   ```

4. root権限であることを確認する
   ```
   id
   ```

5. システムログ確認
   ```
   cat /var/log/messages | egrep -i "error|warn|crit|fail|fatal|panic|alert|alarm|emerg"
   ```

-----------------------------------------------------------------------------------
## 3. 新AccessCheckとのルーティング追加
-----------------------------------------------------------------------------------
1. バックアップ取得<br>
   ```
   cp -p /etc/sysconfig/network-scripts/route-ens192 /etc/sysconfig/network-scripts/_route-ens192.`date '+%Y%m%d'`
   ```
   差分比較<br>
   ★差分がないことを確認
   ```
   diff /etc/sysconfig/network-scripts/route-ens192 /etc/sysconfig/network-scripts/_route-ens192.`date '+%Y%m%d'`
   ```

2. ルーティング追加<br>
   ★tofr501vの場合<br>
   route-ens192を編集する
   ```
   vi /etc/sysconfig/network-scripts/route-ens192
   ```
   ファイルの最下部に以下の記述を追加する<br>
   ```
   172.26.42.121 via 172.22.4.1
   172.26.42.122 via 172.22.4.1
   172.26.42.123 via 172.22.4.1
   172.26.42.124 via 172.22.4.1
   172.26.42.126 via 172.22.4.1
   172.26.42.127 via 172.22.4.1
   172.26.42.128 via 172.22.4.1
   172.26.42.129 via 172.22.4.1
   ```

   ★tofr501v以外の場合<br>
   route-ens192を編集する
   ```
   vi /etc/sysconfig/network-scripts/route-ens192
   ```
   ファイルの最下部に以下の記述を追加する<br>
   ```
   172.26.42.121 via 172.22.4.1 dev ens192
   172.26.42.122 via 172.22.4.1 dev ens192
   172.26.42.123 via 172.22.4.1 dev ens192
   172.26.42.124 via 172.22.4.1 dev ens192
   172.26.42.126 via 172.22.4.1 dev ens192
   172.26.42.127 via 172.22.4.1 dev ens192
   172.26.42.128 via 172.22.4.1 dev ens192
   172.26.42.129 via 172.22.4.1 dev ens192
   ```
   差分確認<br>
   ★変更箇所のみ差分が出力されることを確認
   ```
   diff /etc/sysconfig/network-scripts/route-ens192 /etc/sysconfig/network-scripts/_route-ens192.`date '+%Y%m%d'`
   ```

3. 設定反映前ルーティング確認<br>
   ★追加したIPがないことを確認
   ```
   netstat -nr
   ```
   ★確認するIP
   - 172.26.42.121
   - 172.26.42.122
   - 172.26.42.123
   - 172.26.42.124
   - 172.26.42.126
   - 172.26.42.127
   - 172.26.42.128
   - 172.26.42.129

4. 設定反映
   ```
   /etc/sysconfig/network-scripts/ifup-routes ens192
   ```

5. 設定反映後ルーティング確認<br>
   ★追加したIPがあることを確認
   ```
   netstat -nr
   ```
   ★確認するIP
   - 172.26.42.121
   - 172.26.42.122
   - 172.26.42.123
   - 172.26.42.124
   - 172.26.42.126
   - 172.26.42.127
   - 172.26.42.128
   - 172.26.42.129

6. システムログ確認
   ```
   cat /var/log/messages | egrep -i "error|warn|crit|fail|fatal|panic|alert|alarm|emerg"
   ```

-----------------------------------------------------------------------------------
## 99. 事後作業
-----------------------------------------------------------------------------------
1. Tera Termからログアウトする
   ```
   exit
   exit
   ```

2. サーバログイン確認
   新AccessCheck経由でサーバにログインできることを確認する
   ホスト(T)：ac10

3. 作業完了連絡
   依頼者に変更完了の連絡を行う

4. 作業エビデンス格納
   作業エビデンスを資料格納先に保存する
